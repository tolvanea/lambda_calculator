<!doctype html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Lambda Calculator" />
        <meta property="og:description" content="Online lambda calculus evaluator tool, and also a Turing complete programming language." />
        <meta property="og:image" content="https://raw.githubusercontent.com/tolvanea/lambda_calculator/refs/heads/master/images/hello.png" />
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
        <title>Lambda calculator</title>
        <style>
            body {
                display: flex;
                height: 98vh; /* Full height of the viewport */
                width: 99vw; /* Full height of the viewport */
                margin: 0; /* Remove default margin */
                font-family: 'Arial', sans-serif;
            }

            #main-container {
                display: flex;
                padding: 20px; /* Add padding */
                /*flex: 0 0 68%; /* Left side: 60% width */
                flex-direction: column;
                width: 68vw;
            }

            #right-side-panel {
                /*display: flex;*/
                padding: 20px; /* Add padding */
                /*flex: 0 0 28%; /* Rigth side: 30% width */
                width: 28vw;
                flex-direction: column;
                background-color: #f0f0f0; /* Light background color for documentation */
            }

            #doc-container {
                flex: 1; /* Occupy the top half */
                display: flex; /* Use flexbox for layout */
                flex-direction: column; /* Stack children vertically */
                /*flex: 0 0 28%; /* Right side: 40% width */
                padding: 20px; /* Add padding */
                /*background: color url('images/ponka.png') others;*/
                overflow-y: auto; /* Enable vertical scrolling if needed */
                height: 63vh;
                justify-content: flex-start; /* Align content to the top */
                /*justify-content: center;*/
                /*align-items: center;*/
                border: 3px solid #ccc; /* Add a border */
            }

            .image-wrapper {
                flex: 1; /* Occupy the top half */
                display: flex; /* Use flexbox for centering */
                justify-content: center; /* Center the image horizontally */
                width: 100%; /* Full width of the container */
                margin-top: auto; /* Push the image to the bottom of the container */
                height: 28vh;
            }

            #input-container {
                display: flex;
                flex-direction: column;
                justify-content: center; /* Center content vertically */
                align-items: center;
                padding: 40px; /* Add padding */
                height: 50vh;
            }

            #how-the-fuck-i-center-a-div {
                display: flex;
                align-items: center;
                justify-content: center
            }

            #output-container {
                display: flex;
                flex-direction: column;
                justify-content: flex-start; /* Align content to the top */
                padding: 20px; /* Add padding */
                height: 40vh;
                overflow-y: auto;
                overflow-x: auto;
            }

            /* Style for the output area */
            #output {
                font-family: monospace; /* Set to monospace font */
                white-space: pre; /* Preserve whitespace */
                border: 1px solid #ccc; /* Add a border */
                padding: 20px; /* Add some padding */
                background-color: #f9f9f9; /* Light background color */
                height: 100%;
                overflow-y: auto; /* Enable vertical scrolling if needed */
            }

            #input {
                flex: 0; /* Allow the textarea to grow */
                height: 100%;
                width: 100%; /* Full width */
                resize: none; /* Prevent resizing */
                padding: 20px; /* Add padding */
                background-color: #f9f9f9; /* Light background color */
                border: 1px solid #ccc; /* Add a border */
                border-radius: 4px; /* Rounded corners */
            }

            #compile {
                margin-bottom: 20px; /* Add margin around the button */
                width: 50%;
                height: 50px;
                font-size: 25px;
                border-radius: 6px;
                background-color: #C593D9;
                color: white;
                cursor: pointer;
            }

            #doc-image {
                max-height: 100%; /* Scale the image to fit within the container's height */
                max-width: 100%; /* Ensure the image does not exceed the container's width */
                height: auto; /* Maintain aspect ratio */
                width: auto; /* Maintain aspect ratio */
                opacity: 0.5; /* Set transparency to 50% */
                margin-top: auto; /* Push the image to the bottom of the container */
            }

            code {
                /*background-color: #d4d4d4; /* Light gray background for the code block */
                color: #003344; /* Darker text color for the code */
                font-family: 'Courier New', Courier, monospace; /* Monospace font for code */
            }

            .bold {
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div id="main-container">
            <h1 style="text-align: center;">Lambda calculator</h1>
            <div id="input-container">
                <textarea id="input" placeholder="Type the code here" rows="5" style="flex: 1; width: 100%;"></textarea>
            </div>
            <div id="how-the-fuck-i-center-a-div">
                <button id="compile">go brrrrrrrrr</button>
                <label>
                    <input type="checkbox" id="debug_parse" style="margin-left: 30px" checked> Debug parsing
                </label>
            </div>
            <div id="output-container">
                <div id="output" aria-label="Output will appear here..."></div>
            </div>
        </div>
        <div id="right-side-panel">
            <div id="doc-container">
                <h1>What is this?</h1><p>

                Untyped <a href="https://www.youtube.com/watch?v=RcVA8Nj6HEo">lambda calculus</a> evaluation tool, and thus Turing complete programming language. Because all of computation can be built on top of pure lambda functions, (no "values" required,) this is a kind of sandbox where you first need to define what is a number or what is a boolean before you can do anything useful. This is like <a href="https://nandgame.com/">nand-game</a> but with functions only.

                <h2>Umm, what?</h2><p>
                This is a lambda <b><i>function definition</i></b>
                <pre><code>λab.a</code></pre><p>

                It takes two parameters <code>a</code> and <code>b</code>, and returns the first parameter <code>a</code>.
                <p>
                <b><i>Evaluation</i></b> of a lambda function is made by putting it inside the parenthesis with the arguments:
                <pre><code>(λab.a argument1 argument2)</code></pre><p>
                So instead of the common function call notation <code>f(a, b)</code>, it is <code>(f a b)</code>. Well anyways, in this case the function returns the first parameter, so it would evaluate to <code>argument1</code>.
                <p>
                Here the <code>argument1</code> and <code>argument2</code> are some expressions. An expression is either of the above:
                <ul>
                    <li>function definition <code>λ...</code>, or</li>
                    <li>function evaluation <code>(...)</code></li>
                </ul>

                <p>
                The program consists of the assignments, a keyword <code>in</code>, and one expression.
                For example, this is a valid program you can insert to the left
                <pre><code>argument1 = λc.c
argument2 = λd.d
in
(λab.a argument1 argument2)</code></pre>
                It evaluates to
                <pre><code>λc.c</code></pre>

                <h2>Ok, and?</h2><p>
                That's it! There is nothing more! No classes, no numbers, no booleans. Only pure lambda functions. The task here is to build everything from bottom up, starting from lambda functions. For example, a boolean calculation "FALSE AND TRUE" can be encoded like so:
                <pre><code>true = λab.a
false = λab.b
and = λxy.(x y false)
in
(and true false)</code></pre>
                Try copy-pasting it to the left, it evaluates to
                <pre><code>λa.λb.b</code></pre>
                <h4>Wait why <code>λa.λb.b</code> instead of <code>λab.b</code>?</h4><p>
                Because that is internal representation of lambda calculus, as lambda calculus does not have multiparameter functions. A two parameter function <code>λab</code> is actually just a syntax sugar to a single parameter function <code>λa</code> that returns a single parameter function <code>λb</code>. You can feed two arguments in and it works as if it was a two parameter function.

                <h2>But why?</h2><p>
                All of computation can be formulated on top of functions! How cool is that!
                <p>
                I was inspired by this <a href="https://www.youtube.com/watch?v=RcVA8Nj6HEo">video</a>, see it, it's awesome.


                <h2>Can I hide the pony below?</h2><p>
                No, it's integral part of the tool.

                <h2>Standard library</h2><p>
                Copy paste whatever fragments you need from here. Also see the <a href="https://en.wikipedia.org/wiki/Lambda_calculus#Encoding_datatypes">wikipedia page</a>.

                <pre><code>true = λab.a
false = λab.b
and = λxy.(x y false)

# Numbers encoded as recursive function calls
0 = λfx.x
1 = λfx.(f x)
2 = λfx.(f (f x))
3 = λfx.(f (f (f x)))
4 = λfx.(f (f (f (f x))))
+1 = λnfx.(f (n f x))
-1 = λnfx.(n λgh.(h (g f)) (λu.x) (λu.u))

# Arithmetic
+ = λnmfx.((n f) (m f x))
* = λnmf.(m (n f))
- = λmn.(n -1 m)
^ = λnm.(m n)
↑↑ = λmn.((-1 n) (^ m) m)

# Pairs: x=first, y= second, h=head, t=tail
pair = λxyf.(f x y)
nil = false
fst = λl.(l λhtd.h nil)
snd = λl.(l λhtd.t nil)
is_nill = λl.(l λhtd.false true)

# Recursion with Y-combinator
u = λxy.(y (x x y))
Y = (u u)

# Factorial
if_0 = λn.((n λa.false) true)
factorial = λfn.(if_0 n 1 (* n (f (-1 n))))
! = (u u factorial)

# List processing
rfold = λfa.(Y (λrl.(l λhtd.(f (r t) h) a)))
map = λf.(rfold (λah.(pair (f h) a)) nil)
[1,2,3] = (pair 1 (pair 2 (pair 3 nil)))
</code></pre>

                <h2>Examples</h2><p>
                As examples, using the definitions in the "standard library" above, following expression can be calculated.
                <pre><code># 1 + 1 = 2
(+ 1 1)

# 2^2^2 = 16
(↑↑ 2 3)

# 3! = 3 * 2 * 1 = 6
(! 3)

# 1^2 + 2^2 + 3^2 = 14
(rfold + 0 (map (^ 2) [1,2,3]))
</code></pre>

            </div>
            <div class="image-wrapper"> <!-- New wrapper for the image -->
                <img id="pony" src="images/hello.png" alt="structure and interpretation of computer programs" id="doc-image">
            </div>
        </div>


        <script type="module">
            import init, { process_input } from './pkg/lamlang.js';

            async function run() {
                await init();
                document.getElementById('compile').onclick = () => {
                    const input = document.getElementById('input').value;
                    const outputBox = document.getElementById('output')


                    const checkbox = document.getElementById('debug_parse');
                    const img = document.getElementById('pony');

                    try {
                        const output = process_input(input, checkbox.checked);
                        outputBox.innerHTML = output;
                        outputBox.style.backgroundColor = "#f9f9f9";
                        img.src = 'images/hello.png';
                    } catch (error) {
                        if (error == "RuntimeError: unreachable executed") {
                            outputBox.textContent = "Uh oh, uhmm... this should not have happened. Something broke.\nCould you report me what input you used? Pwetty pwease 🥺👉👈"
                        } else {
                            outputBox.innerHTML = error;
                        }
                        outputBox.style.backgroundColor = "#fff8f8";
                        img.src = 'images/ded.png';
                    }
                };
            }
            run();
        </script>
    </body>
</html>

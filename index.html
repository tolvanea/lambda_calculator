<!doctype html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Lambda Calculator" />
        <meta property="og:description" content="Online lambda calculus evaluation tool, and also a Turing complete programming language." />
        <meta property="og:image" content="https://raw.githubusercontent.com/tolvanea/lambda_calculator/refs/heads/master/images/hello.png" />
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
        <title>Lambda calculator</title>
        <style>
            body {
                display: flex;
                height: 98vh; /* Full height of the viewport */
                width: 99vw; /* Full height of the viewport */
                margin: 0; /* Remove default margin */
                font-family: 'Arial', sans-serif;
            }

            #main-container {
                display: flex;
                padding: 20px; /* Add padding */
                /*flex: 0 0 68%; /* Left side: 60% width */
                flex-direction: column;
                width: 68vw;
            }

            #right-side-panel {
                /*display: flex;*/
                padding: 20px; /* Add padding */
                /*flex: 0 0 28%; /* Rigth side: 30% width */
                width: 28vw;
                flex-direction: column;
                background-color: #f0f0f0; /* Light background color for documentation */
            }

            #doc-container {
                flex: 1; /* Occupy the top half */
                display: flex; /* Use flexbox for layout */
                flex-direction: column; /* Stack children vertically */
                /*flex: 0 0 28%; /* Right side: 40% width */
                padding: 20px; /* Add padding */
                /*background: color url('images/ponka.png') others;*/
                overflow-y: auto; /* Enable vertical scrolling if needed */
                height: 63vh;
                justify-content: flex-start; /* Align content to the top */
                /*justify-content: center;*/
                /*align-items: center;*/
                border: 3px solid #ccc; /* Add a border */
            }

            .image-wrapper {
                flex: 1; /* Occupy the top half */
                display: flex; /* Use flexbox for centering */
                justify-content: center; /* Center the image horizontally */
                width: 100%; /* Full width of the container */
                margin-top: auto; /* Push the image to the bottom of the container */
                height: 28vh;
            }

            #input-container {
                display: flex;
                flex-direction: column;
                justify-content: center; /* Center content vertically */
                align-items: center;
                padding: 40px; /* Add padding */
                height: 50vh;
            }

            #how-the-fuck-i-center-a-div {
                display: flex;
                align-items: center;
                justify-content: center
            }

            #output-container {
                display: flex;
                flex-direction: column;
                justify-content: flex-start; /* Align content to the top */
                padding: 20px; /* Add padding */
                height: 40vh;
                overflow-y: auto;
                overflow-x: auto;
            }

            /* Style for the output area */
            #output {
                font-family: monospace; /* Set to monospace font */
                white-space: pre; /* Preserve whitespace */
                border: 1px solid #ccc; /* Add a border */
                padding: 20px; /* Add some padding */
                font-size: 16px;
                background-color: #f9f9f9; /* Light background color */
                height: 100%;
                overflow-y: auto; /* Enable vertical scrolling if needed */
            }

            #input {
                flex: 0; /* Allow the textarea to grow */
                height: 100%;
                width: 100%; /* Full width */
                resize: none; /* Prevent resizing */
                padding: 20px; /* Add padding */
                font-size: 16px;
                background-color: #f9f9f9; /* Light background color */
                border: 1px solid #ccc; /* Add a border */
                border-radius: 4px; /* Rounded corners */
            }

            #compile {
                margin-bottom: 20px; /* Add margin around the button */
                width: 20%;
                height: 50px;
                font-size: 25px;
                border-radius: 6px;
                background-color: #C593D9;
                color: white;
                cursor: pointer;
            }

            #doc-image {
                max-height: 100%; /* Scale the image to fit within the container's height */
                max-width: 100%; /* Ensure the image does not exceed the container's width */
                height: auto; /* Maintain aspect ratio */
                width: auto; /* Maintain aspect ratio */
                opacity: 0.5; /* Set transparency to 50% */
                margin-top: auto; /* Push the image to the bottom of the container */
            }

            code {
                /*background-color: #d4d4d4; /* Light gray background for the code block */
                color: #003344; /* Darker text color for the code */
                font-family: 'Courier New', Courier, monospace; /* Monospace font for code */
            }

            .bold {
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div id="main-container">
            <h1 style="text-align: center;">Lambda calculator</h1>
            <div id="input-container">
                <textarea id="input" rows="5" style="flex: 1; width: 100%;">true = 位ab.a
false = 位ab.b
and = 位xy.(x y false)
in
(and true false)</textarea>
            </div>
            <div id="how-the-fuck-i-center-a-div">
                <button id="compile">Run</button>
                <label>
                    <input type="checkbox" id="debug_parse" style="margin-left: 30px" checked> Debug parsing
                </label>
            </div>
            <div id="output-container">
                <div id="output" aria-label="Output will appear here..."></div>
            </div>
        </div>
        <div id="right-side-panel">
            <div id="doc-container">
                <h1>What is this?</h1><p>

                Untyped <a href="https://www.youtube.com/watch?v=RcVA8Nj6HEo">lambda calculus</a> evaluation tool, and thus Turing complete programming language. All of computation can be built on top of pure lambda functions, and this is a kind of sandbox where you first define what is a number before you can do anything useful. Like <a href="https://nandgame.com/">nand-game</a> but with functions.

                <h2>Umm, what?</h2><p>
                This is a lambda <b><i>function definition</i></b>
                <pre><code>位ab.a</code></pre><p>

                It takes two parameters <code>a</code> and <code>b</code>, and returns the first parameter <code>a</code>. The <code>a</code> and <code>b</code> are also called <b><i>symbols</i></b>.
                <p>
                <b><i>Function evaluation</i></b> is written with parenthesis wrapping both function and its arguments:
                <pre><code >(位ab.a argument1 argument2)</code></pre><p>
                So instead of the common function call notation <code style="white-space: nowrap;">f(a, b)</code>, it is <code style="white-space: nowrap;">(f a b)</code>. In the example above the function <code style="white-space: nowrap;">位ab.a</code> returns the first parameter <code>a</code>, evaluating to <code>argument1</code>.
                <p>
                Here the <code>argument1</code> and <code>argument2</code> are some <i>expressions</i>. An expression is either function definition, function evaluation, or symbol. It can be a deeply nested structure.

                <p>
                The program consists of the assignments, a keyword <code>in</code>, and one expression.
                For example, this is a valid program you can insert to the left
                <pre><code>argument1 = 位c.c
argument2 = 位d.d
in
(位ab.a argument1 argument2)</code></pre>
                It evaluates to
                <pre><code>位c.c</code></pre>

                <h2>Ok, and?</h2><p>
                That's it! There is nothing more! No numbers, no if-statements, no loops. Only pure lambda functions. The task is to build the programming language primitives from pure lambda functions. These primitives can be then used to build more intuitive programs. This goes extreme on the paradigm of functional programming: <i>"Building your own programming language first"</i>

                <p>
                You have full liberty to decide what is true. For example, boolean calculation "<i>false and true</i>" can be encoded like so:
                <pre><code>true = 位ab.a
false = 位ab.b
and = 位xy.(x y false)
in
(and true false)</code></pre>
                Try copy-pasting it to the left, it evaluates to
                <pre><code>位a.位b.b</code></pre>
                <h4>Wait, why <code>位a.位b.b</code> instead of <code>位ab.b</code>?</h4><p>
                Because that is just internal representation in lambda calculus, which does not have multiparameter functions. A two parameter function <code>位ab</code> is just a syntax sugar to a single parameter function <code>位a</code> that returns a single parameter function <code>位b</code>. This behaves as a two parameter function.

                <h2>But why?</h2><p>
                All of computation can be formulated on top of functions! How cool is that!
                See this <a href="https://www.youtube.com/watch?v=RcVA8Nj6HEo">video</a>, it's awesome.


                <h2>Can I hide the pony below?</h2><p>
                No, she's integral part of the interpreter.

                <h2>Standard library</h2><p>
                Copy paste whatever fragments you need from here. Or all.

                <pre><code>true = 位ab.a
false = 位ab.b
and = 位xy.(x y false)
or = 位xy.(x true y)

# Numbers encoded as recursive function calls
0 = 位fx.x
1 = 位fx.(f x)
2 = 位fx.(f (f x))
3 = 位fx.(f (f (f x)))
4 = 位fx.(f (f (f (f x))))
5 = 位fx.(f (f (f (f (f x)))))
+1 = 位nfx.(f (n f x))
-1 = 位nfx.(n 位gh.(h (g f)) (位u.x) (位u.u))

# Arithmetic
+ = 位nmfx.((n f) (m f x))
* = 位nmf.(m (n f))
- = 位mn.(n -1 m)
^ = 位nm.(m n)
 = 位mn.((-1 n) (^ m) m)

# Pairs: x=first, y= second, h=head, t=tail
pair = 位xyf.(f x y)
nil = false
fst = 位l.(l 位htd.h nil)
snd = 位l.(l 位htd.t nil)
is_nill = 位l.(l 位htd.false true)

# Recursion with Y-combinator
u = 位xy.(y (x x y))
Y = (u u)

# Factorial
if_0 = 位n.((n 位a.false) true)
! = (Y 位fn.(if_0 n 1 (* n (f (-1 n)))))

# List processing
rfold = 位fa.(Y (位rl.(l 位htd.(f (r t) h) a)))
map = 位f.(rfold (位ah.(pair (f h) a)) nil)
[1,2,3] = (pair 1 (pair 2 (pair 3 nil)))
</code></pre>

                See also <a href="https://en.wikipedia.org/wiki/Lambda_calculus#Encoding_datatypes">wikipedia page</a>

                <h2>Examples</h2><p>
                Using the definitions in the "standard library", following expression can be calculated. Note, copy-paste only one expression after <code>in</code> statement at a time.
                <pre><code># 1 + 1 = 2
(+ 1 1)

# 2 * 4 = 8
(* 2 4)

# 2^2^2 = 16
( 2 3)

# 3! = 3 * 2 * 1 = 6
(! 3)

# 1^2 + 2^2 + 3^2 = 14
(rfold + 0 (map (^ 2) [1,2,3]))

</code></pre>
                You may notice that there is no real need for numbers larger than 4, as your computer is throttling anyways. Many operations, especially the -1, are extremely inefficient requiring ridiculous amount of 尾-reduction cycles. Any meaningful programs are thus infeasible with this tool.

            </div>
            <div class="image-wrapper"> <!-- New wrapper for the image -->
                <img id="pony" src="images/hello.png" alt="structure and interpretation of computer programs" id="doc-image">
            </div>
        </div>


        <script type="module">
            import init, { process_input } from './pkg/lamlang.js';

            async function run() {
                await init();
                document.getElementById('compile').onclick = () => {
                    const input = document.getElementById('input').value;
                    const outputBox = document.getElementById('output')


                    const checkbox = document.getElementById('debug_parse');
                    const img = document.getElementById('pony');

                    try {
                        const output = process_input(input, checkbox.checked);
                        outputBox.innerHTML = output;
                        outputBox.style.backgroundColor = "#f9f9f9";
                        img.src = 'images/hello.png';
                    } catch (error) {
                        if (error == "RuntimeError: unreachable executed") {
                            outputBox.textContent = "Uh oh, uhmm... this should not have happened. Something broke.\nCould you report me what input you used? Pwetty pwease ズ"
                        } else {
                            outputBox.innerHTML = error;
                        }
                        outputBox.style.backgroundColor = "#fff8f8";
                        img.src = 'images/ded.png';
                    }
                };
            }
            run();
        </script>
    </body>
</html>
